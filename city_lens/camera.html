<!DOCTYPE HTML>

<html lang="zh" style="font-size:100px">

<head>
    <meta charset="utf-8" />
    <title>城市望远镜 - Hello全视界</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <script src="../lib/three.js"></script>

    <script src="../lib/vue.js"></script>

    <script src="../control_stick/util.js"></script>

    <script src="../js/poi_handler.js"></script>

    <script src="../js/public.js"></script>
    <style>
        html,
        body,
        #app {
            padding: 0;
            margin: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        video.fromCamera {
            width: 100vw;
            height: 100vh;
            object-fit: cover;
        }
    </style>
</head>

<body>
    <div id="app">
        <video class="fromCamera" id='video'></video>
        <div class="canvasWrap">

        </div>
    </div>
    <script>

        var cityLensApp = new Vue({
            el: '#app',
            data: {},
            mounted: function () {
                var _this = this;
                _this.video = document.querySelector('video.fromCamera');
                //获得用户媒体相关选项
                _this.cameraOptions = {
                    video: {
                        width: window.innerWidth,
                        height: window.innerHeight,
                        facingMode: { exact: "environment" }
                    }
                }
                getUserMedia(_this.cameraOptions, _this.cameraHandler.bind(this), _this.cameraError.bind(this));

            },
            methods: {
                cameraHandler: function (stream) {
                    var _this = this;
                    this.video.srcObject = stream;
                    this.video.onloadedmetadata = function (e) {
                        _this.video.play();
                    }
                },

                cameraError: function (e) {
                    console.log(e);
                    if (e.constraint == "facingMode" && e.name == "OverconstrainedError") {
                        this.cameraOptions.video.facingMode = "user";
                        getUserMedia(this.cameraOptions, this.cameraHandler, this.cameraError);
                    } else {
                        return false;
                    }
                }

            }
        })








    </script>
</body>


</html>