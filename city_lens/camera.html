<!DOCTYPE HTML>

<html lang="zh" style="font-size:100px">

<head>
    <meta charset="utf-8" />
    <title>城市望远镜 - Hello全视界</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <script type="text/javascript"
        src="https://api.map.baidu.com/api?v=2.0&ak=4woYXvjYCbrpX0jVGBO2Dy5SxLptnrBa&s=1"></script>
    <script src="../lib/three.js"></script>

    <script src="../lib/vue.js"></script>

    <script src="../control_stick/util.js"></script>

    <script src="../js/bmap_handler.js"></script>

    <script src="../js/poi_handler.js"></script>

    <script src="../js/public.js"></script>
    <style>
        html,
        body,
        #app {
            padding: 0;
            margin: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        div.cameraContainer {
            width: 100vw;
            height: 100vh;
        }

        video.fromCamera {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        div.canvasWrap {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="cameraContainer">
            <video class="fromCamera"></video>
            <div class="canvasWrap"></div>
        </div>
    </div>
    <script>

        var cityLensApp = new Vue({
            el: '#app',
            data: {
                cameraOptions: {},
                GPSOptions: {},
                videoEl: null
            },
            mounted: function () {
                //获得用户媒体相关选项
                this.videoEl = document.querySelector('video.fromCamera');
                this.cameraOptions = {
                    video: {
                        width: window.innerWidth,
                        height: window.innerHeight,
                        facingMode: { exact: "environment" }
                    }
                }
                getUserMedia(this.cameraOptions, this.cameraHandler.bind(this), this.cameraError.bind(this));

                //获得GPS数据
                this.GPSOptions = {
                    enableHighAccuracy: true,
                    maximumAge: 30000,
                    timeout: 60000
                }

                navigator.geolocation.getCurrentPosition(this.positionHandler, this.errorHandler, this.GPSOptions);

            },
            methods: {
                //相机相关函数
                cameraHandler: function (stream) {
                    var _this = this;
                    this.videoEl.srcObject = stream;
                    this.videoEl.onloadedmetadata = function (e) {
                        _this.videoEl.play();
                    }
                },

                cameraError: function (e) {
                    console.log(e);
                    if (e.constraint == "facingMode" && e.name == "OverconstrainedError") {
                        this.cameraOptions.video.facingMode = "user";
                        getUserMedia(this.cameraOptions, this.cameraHandler, this.cameraError);
                    } else {
                        return false;
                    }
                },

                //GPS
                positionHandler: function (pos) {
                    console.log(pos);
                    this.curGPSCood = {
                        lng: pos.coords.longitude,
                        lat: pos.coords.latitude,
                        // lng: 116.313408,
                        // lat: 39.925278,
                        errCode: -1
                    };
                    
                    new BaiduMap(this.curGPSCood.lng,this.curGPSCood.lat);

                    // this.bMapSearch("厕所", 2000);
                },
                errorHandler: function (e) {
                    console.log(e);
                    this.curGPSCood = {
                        //假装在深圳罗湖
                        lng: 114.11858071301268,
                        lat: 22.531815181101916,
                        errCode: 0
                    };
                    console.log('没获取到位置。')
                },






                //三维场景

                //陀螺仪

            }
        })








    </script>
</body>


</html>