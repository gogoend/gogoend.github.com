<html style="font-size:100px">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <style>
        body {
            padding: 0;
            margin: 0;
            position: relative;
        }

        .slideBar {
            height: 0.5rem;
            width: 80%;
            /* position: absolute; */
            display: flex;
            align-items: center;
            left: 0px;
        }

        .slideBar>.stick {
            position: absolute;
            display: block;
            width: 0.2rem;
            height: 0.2rem;
            background-color: #62d128;
            border: #62d128 solid 2px;
            border-radius: 50%;
            flex-shrink: 0;
            opacity: 0.5;
            margin-left: -0.1rem;
            left: 0;
        }

        .slideBar>.bar {
            width: 100%;
            display: block;
            height: 2px;
            background: #62d128;
        }
    </style>
    <script src="../control_stick/util.js"></script>
</head>

<body>
    <div class="slideBar" data-role="slideBar">
        <span class="stick"></span>
        <div class="bar"></div>
    </div>
    <div class="target" style="
    width:200px;
    height: 200px;
    margin-left: 40px;
    margin-top:40px;
    background-color: #62d128;
    "></div>
    <script>
        var SlideBar = function (min, max, callback) {
            var _this = this;
            // _this.oValue=oValue;
            _this.min = min;
            _this.max = max;

            var slideBar = document.querySelector('[data-role="slideBar"]');
            var stick = slideBar.querySelector('.stick');
            var bar = slideBar.querySelector('.bar');
            console.log(slideBar)

            this.slideBar = slideBar;
            this.stick = stick;
            this.bar = bar;

            this.finalValue = null;

            //滑块数值
            var persentNum;
            Object.defineProperty(this, 'persentNum', {
                set: function (n) {
                    persentNum = n;
                    slideBar.setAttribute('data-value', (n * 100).toFixed(0));

                    var value = util.clamp(_this.min + (_this.max - _this.min) * n, _this.min, _this.max);
                    this.finalValue = value;

                    if (callback) {
                        callback({
                            persent: n,
                            value: _this.finalValue
                        });
                    }
                },
                get: function () {
                    return persentNum;
                }
            });


            // slideBar.addEventListener('mousedown', this.eventTodo.bind(_this), false);
            slideBar.addEventListener('click', this.eventTodo.bind(_this), false);
            window.addEventListener('resize', function (e) {
                _this.stick.style.left = _this.persentNum * parseInt(util.getStyle(_this.bar).width) + 'px';
            }, false)
            slideBar.addEventListener('drag', this.eventTodo.bind(_this), false);
            slideBar.addEventListener('dragend', this.eventTodo.bind(_this), false);
        }

        SlideBar.prototype.eventTodo = function (e) {
            if (e.type.match('touch') !== null) {
                e = e.touches[0];
            }
            var stick = this.stick;
            var bar = this.bar;
            switch (e.type) {
                case 'click': {
                    if (e.target.className !== 'stick') {
                        stick.style.transition = '0.5s ease left'
                        var leftValue = e.clientX;
                        stick.style.left = util.clamp(leftValue, 0, parseInt(util.getStyle(bar).width)) + 'px';
                        stick.addEventListener('transitionend', function () {
                            stick.style.transition = 'none';
                        }, false);

                        this.persentNum = parseInt(stick.style.left) / parseInt(util.getStyle(bar).width);
                        // console.log(this.persentNum);

                    }
                }; break;

                case 'drag':
                case 'dragend': {
                    e.preventDefault();
                    var leftValue = e.clientX;
                    stick.style.left = util.clamp(leftValue, 0, parseInt(util.getStyle(bar).width)) + 'px';
                    this.persentNum = parseInt(stick.style.left) / parseInt(util.getStyle(bar).width);
                }; break;
            }
        }

        var target = document.querySelector(".target");

        new SlideBar(10, 600, function (val) {
            target.style.width=100*val.persent+'%';
        })
    </script>
</body>

</html>